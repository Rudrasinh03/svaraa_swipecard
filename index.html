<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>AR Tinder Card – Stable Flip</title>

<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.0/dist/mindar-image-aframe.prod.js"></script>

<style>
html,body{
  margin:0;
  width:100%;
  height:100%;
  overflow:hidden;
  background:transparent;
  touch-action:none;
}
#touch{
  position:fixed;
  inset:0;
  z-index:9999;
}
</style>
</head>

<body>
<div id="touch"></div>

<script>
/* ================= DATA ================= */
const IMAGES=[
  "img1.png","img2.png","img3.png",
  "img4.png","img5.png","img6.png",
  "img7.png","img8.png"
];

const LINKS=[
  "https://example.com/1",
  "https://example.com/2",
  "https://example.com/3",
  "https://example.com/4",
  "https://example.com/5",
  "https://example.com/6",
  "https://example.com/7",
  "https://example.com/8"
];

const DETAILS=[
{
  rating:"4.0",reviews:3,
  title:"Nirvana Omkara Lab-Grown Diamond Religious Pendant",
  price:"₹40,460",tax:"(Inclusive of all taxes)",
  specs:{metal:"14KT",color:"Yellow",diamond:"FG/VVSVS"}
},
{
  rating:"3.8",reviews:5,
  title:"Second Product Example",
  price:"₹55,597",tax:"(Inclusive of all taxes)",
  specs:{metal:"18KT",color:"White",diamond:"GH/VS1"}
},
{
  rating:"4.5",reviews:9,
  title:"Third Product Example",
  price:"₹62,000",tax:"(Inclusive of all taxes)",
  specs:{metal:"18KT",color:"Rose Gold",diamond:"EF/VS"}
},
{
  rating:"4.2",reviews:11,
  title:"Classic Solitaire Pendant",
  price:"₹48,900",tax:"(Inclusive of all taxes)",
  specs:{metal:"14KT",color:"White",diamond:"FG/VS"}
},
{
  rating:"4.6",reviews:18,
  title:"Minimal Heart Diamond Necklace",
  price:"₹52,300",tax:"(Inclusive of all taxes)",
  specs:{metal:"18KT",color:"Rose Gold",diamond:"EF/VVS"}
},
{
  rating:"3.9",reviews:7,
  title:"Daily Wear Diamond Charm",
  price:"₹35,750",tax:"(Inclusive of all taxes)",
  specs:{metal:"14KT",color:"Yellow",diamond:"GH/SI"}
},
{
  rating:"4.8",reviews:25,
  title:"Luxury Emerald Cut Pendant",
  price:"₹74,999",tax:"(Inclusive of all taxes)",
  specs:{metal:"18KT",color:"White",diamond:"EF/VVS"}
},
{
  rating:"4.1",reviews:10,
  title:"Modern Oval Diamond Necklace",
  price:"₹59,400",tax:"(Inclusive of all taxes)",
  specs:{metal:"18KT",color:"Rose Gold",diamond:"FG/VS"}
}
];

/* ================= SWIPE ================= */
class Swipe{
  constructor(el,cb){
    this.cb=cb;
    el.addEventListener("pointerdown",e=>this.start(e));
    el.addEventListener("pointermove",e=>this.move(e));
    el.addEventListener("pointerup",e=>this.end(e));
  }
  start(e){
    this.x0=e.clientX;
    this.y0=e.clientY;
    this.t0=Date.now();
    this.active=true;
  }
  move(e){
    if(!this.active) return;
    const dx=e.clientX-this.x0;
    if(Math.abs(dx)<3) return;
    this.cb.drag(dx);
  }
  end(e){
    if(!this.active) return;
    this.active=false;
    const dx=e.clientX-this.x0;
    const dy=e.clientY-this.y0;
    const dt=Date.now()-this.t0;

    if(Math.abs(dx)<10 && Math.abs(dy)<10 && dt<250){
      this.cb.tap(); return;
    }
    if(Math.abs(dy)>Math.abs(dx) && Math.abs(dy)>80){
      this.cb.vertical(); return;
    }
    if(Math.abs(dx)>80){
      this.cb.swipe(dx>0?"RIGHT":"LEFT");
    }else{
      this.cb.release();
    }
  }
}

/* ================= CARD ================= */
AFRAME.registerComponent("tinder-stack",{
init(){
  this.i=0;
  this.busy=false;
  this.flipped=false;
  this.smoothX=0;
  this.targetX=0;

  /* BACK STACK */
  this.peek2=document.createElement("a-image");
  this.peek2.setAttribute("width","1");
  this.peek2.setAttribute("height","1.4");
  this.peek2.setAttribute("position","0 -0.08 -0.06");
  this.peek2.setAttribute("opacity","0.35");
  this.el.appendChild(this.peek2);

  this.peek1=document.createElement("a-image");
  this.peek1.setAttribute("width","1");
  this.peek1.setAttribute("height","1.4");
  this.peek1.setAttribute("position","0 -0.04 -0.03");
  this.peek1.setAttribute("opacity","0.55");
  this.el.appendChild(this.peek1);

  this.wrap=document.createElement("a-entity");
  this.wrap.setAttribute("position","0 0.2 0");
  this.el.appendChild(this.wrap);

  /* FRONT */
  this.front=document.createElement("a-image");
  this.front.setAttribute("width","1");
  this.front.setAttribute("height","1.4");
  this.front.setAttribute("position","0 0 0.01");
  this.front.setAttribute("visible",true);
  this.wrap.appendChild(this.front);

  /* BACK */
  this.back=document.createElement("a-plane");
  this.back.setAttribute("width","1");
  this.back.setAttribute("height","1.4");
  this.back.setAttribute("color","#f3e1e1");
  this.back.setAttribute("rotation","0 180 0");
  this.back.setAttribute("visible",false);
  this.wrap.appendChild(this.back);

  const c=document.createElement("a-entity");
  c.setAttribute("position","0 0 0.02");
  this.back.appendChild(c);

  const t=(y,w=0.82,c="#222",fw="400")=>{
    const e=document.createElement("a-text");
    e.setAttribute("width",w);
    e.setAttribute("wrap-count","28");
    e.setAttribute("align","center");
    e.setAttribute("font","mozillavr");
    e.setAttribute("shader","msdf");
    e.setAttribute("color",c);
    e.setAttribute("font-weight",fw);
    e.setAttribute("position",`0 ${y} 0`);
    return e;
  };

  this.rating=t(0.55,0.8,"#1e665f","600");
  this.title=t(0.40,0.82,"#222","700");
  this.price=t(0.22,0.8,"#222","700");
  this.tax=t(0.14,0.8,"#777");
  this.specs=t(-0.05,0.8,"#000","600");
  this.select=t(-0.35,0.8,"#3b0b0b","700");

  c.append(this.rating,this.title,this.price,this.tax,this.specs,this.select);

  this.update();

  new Swipe(document.getElementById("touch"),{
    drag:dx=>this.drag(dx),
    release:()=>this.reset(),
    swipe:d=>this.swipe(d),
    tap:()=>window.open(LINKS[this.i],"_blank"),
    vertical:()=>this.flip()
  });

  this.el.setAttribute("visible","false");
},

update(){
  const len=IMAGES.length;
  this.front.setAttribute("src",IMAGES[this.i]);
  this.peek1.setAttribute("src",IMAGES[(this.i+1)%len]);
  this.peek2.setAttribute("src",IMAGES[(this.i+2)%len]);

  const d=DETAILS[this.i];
  this.rating.setAttribute("value",`${d.rating} ★ | ${d.reviews} Reviews`);
  this.title.setAttribute("value",d.title);
  this.price.setAttribute("value",d.price);
  this.tax.setAttribute("value",d.tax);
  this.specs.setAttribute("value",
    `Metal: ${d.specs.metal}\nColor: ${d.specs.color}\nDiamond: ${d.specs.diamond}`
  );
  this.select.setAttribute("value","Select Your Ideal Design");
},

drag(dx){
  if(this.busy||this.flipped) return;
  this.targetX=Math.max(-0.65,Math.min(0.65,dx/220));
  this.smoothX+=(this.targetX-this.smoothX)*0.15;
  const rotZ=this.smoothX*-14;
  const lift=Math.abs(this.smoothX)*0.05;
  this.wrap.setAttribute("position",`${this.smoothX} ${0.2+lift} 0`);
  this.wrap.setAttribute("rotation",`0 0 ${rotZ}`);
},

reset(){
  if(this.busy) return;
  this.wrap.setAttribute("animation__resetPos",{
    property:"position",to:"0 0.2 0",dur:260,easing:"easeOutElastic"
  });
  this.wrap.setAttribute("animation__resetRot",{
    property:"rotation",to:"0 0 0",dur:220,easing:"easeOutCubic"
  });
},

swipe(dir){
  if(this.busy||this.flipped) return;
  this.busy=true;
  const s=dir==="LEFT"?-1:1;

  this.wrap.setAttribute("animation__swipePos",{
    property:"position",to:`${1.8*s} 0.35 -0.3`,dur:320,easing:"easeInCubic"
  });
  this.wrap.setAttribute("animation__swipeRot",{
    property:"rotation",to:`0 0 ${-45*s}`,dur:320,easing:"easeInCubic"
  });

  setTimeout(()=>{
    this.i=(this.i+1)%IMAGES.length;
    this.flipped=false;
    this.front.setAttribute("visible",true);
    this.back.setAttribute("visible",false);
    this.wrap.setAttribute("rotation","0 0 0");
    this.wrap.setAttribute("position","0 0.2 0");
    this.update();
    this.busy=false;
  },340);
},

/* ===== GLITCH-FREE FLIP ===== */
flip(){
  if(this.busy) return;
  this.busy=true;
  const to=this.flipped?0:180;

  setTimeout(()=>{
    this.front.setAttribute("visible",this.flipped);
    this.back.setAttribute("visible",!this.flipped);
  },310);

  this.wrap.setAttribute("animation__flip",{
    property:"rotation",
    to:`0 ${to} 0`,
    dur:620,
    easing:"easeInOutQuart"
  });

  this.wrap.setAttribute("animation__flipDepth",{
    property:"position",
    to:"0 0.2 -0.08",
    dur:300,
    dir:"alternate",
    easing:"easeOutCubic"
  });

  this.wrap.setAttribute("animation__flipScale",{
    property:"scale",
    to:"1.04 1.04 1.04",
    dur:300,
    dir:"alternate",
    easing:"easeOutCubic"
  });

  setTimeout(()=>{
    this.flipped=!this.flipped;
    this.busy=false;
  },620);
}
});
</script>

<a-scene
  mindar-image="imageTargetSrc: targets (1).mind; maxTrack:1; uiLoading:no; uiError:no;"
  embedded
  renderer="alpha:true"
  vr-mode-ui="enabled:false">

<a-camera look-controls="enabled:false"></a-camera>

<a-entity id="target" mindar-image-target="targetIndex:0">
  <a-entity tinder-stack position="0 0.05 0.12"></a-entity>
</a-entity>

</a-scene>

<script>
const t=document.getElementById("target");
const s=document.querySelector("[tinder-stack]");
t.addEventListener("targetFound",()=>s.setAttribute("visible",true));
t.addEventListener("targetLost",()=>s.setAttribute("visible",false));
</script>

</body>
</html>

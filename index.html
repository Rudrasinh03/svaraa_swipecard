<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>AR Diamond Tinder Card - Stabilized</title>

<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.0/dist/mindar-image-aframe.prod.js"></script>

<style>
html,body{ margin:0; width:100%; height:100%; overflow:hidden; background:transparent; touch-action:none; }
#touch{ position:fixed; inset:0; z-index:9999; }
</style>
</head>

<body>
<div id="touch"></div>

<script>
/* ================= PRODUCT DATA ================= */
const IMAGES=["img1.png","img2.png","img3.png","img4.png","img5.png","img6.png","img7.png","img8.png"];
const LINKS=[
  "https://www.svaraa.com/jewellery/nirvana-omkara-lab-grown-diamond-religious-pendant?vid=variant_01KAB6809FF34ZXQKGRFHZ2VMB",
  "https://www.svaraa.com/jewellery/ekdanta-lab-grown-diamond-religious-pendant?vid=variant_01KAB5XKF42F663S41SS8DMENZ",
  "https://www.svaraa.com/jewellery/nirvana-omkare-shwar-lab-grown-diamond-religious-pendant?vid=variant_01KAB5XKF22Y6HE7VSD4ZFTWF3",
  "https://www.svaraa.com/jewellery/someshwara-lab-grown-diamond-religious-pendant?vid=variant_01KAB5XKF2XJBQSW28SVPXWNV4",
  "https://www.svaraa.com/jewellery/nirvana-sacred-mandala-om-lab-grown-diamond-religious-pendant?vid=variant_01KAB5XKF2KBRQ4N7Z6MDA0ZBM",
  "https://www.svaraa.com/jewellery/nirvana-rudra-om-lab-grown-diamond-religious-pendant?vid=variant_01KAB5XKF2Z5BBRWECCE5G5YSR",
  "https://www.svaraa.com/jewellery/vighnaharta-lab-grown-diamond-religious-pendant?vid=variant_01KAB5XKF2VMZTKE5XDNPK2GQY",
  "https://www.svaraa.com/jewellery/nirvana-devine-om-lab-grown-diamond-religious-pendant?vid=variant_01KAB6809FT3KRE67FWYR7RD89"
];

const DETAILS=[
  { rating:"4.0 | 3 REVIEWS", title:"NIRVANA OMKARA\nLAB-GROWN DIAMOND RELIGIOUS\nPENDANT", shortTitle:"NIRVANA OMKARA", price:"₹40,548", tax:"(MRP inclusive of all taxes)", specs:{metal:"14KT",color:"Yellow Gold",diamond:"FG / VVSVS"} },
  { rating:"4.0 | 3 REVIEWS", title:"EKDANTA\nLAB-GROWN DIAMOND RELIGIOUS\nPENDANT", shortTitle:"EKDANTA", price:"₹47,845", tax:"(MRP inclusive of all taxes)", specs:{metal:"14KT",color:"Yellow Gold",diamond:"FG / VVSVS"} },
  { rating:"4.0 | 3 REVIEWS", title:"NIRVANA OMKARESHWAR\nLAB-GROWN DIAMOND RELIGIOUS\nPENDANT", shortTitle:"NIRVANA OMKARESHWAR", price:"₹36,993", tax:"(MRP inclusive of all taxes)", specs:{metal:"14KT",color:"Yellow Gold",diamond:"FG / VVSVS"} },
  { rating:"4.0 | 3 REVIEWS", title:"SOMESHWARA\nLAB-GROWN DIAMOND RELIGIOUS\nPENDANT", shortTitle:"SOMESHWARA", price:"₹49,610", tax:"(MRP inclusive of all taxes)", specs:{metal:"14KT",color:"Yellow Gold",diamond:"FG / VVSVS"} },
  { rating:"4.0 | 3 REVIEWS", title:"NIRVANA SACRED MANDALA OM\nLAB-GROWN DIAMOND RELIGIOUS\nPENDANT", shortTitle:"SACRED MANDALA OM", price:"₹52,510", tax:"(MRP inclusive of all taxes)", specs:{metal:"14KT",color:"Yellow Gold",diamond:"FG / VVSVS"} },
  { rating:"4.0 | 3 REVIEWS", title:"NIRVANA RUDRA OM\nLAB-GROWN DIAMOND RELIGIOUS\nPENDANT", shortTitle:"RUDRA OM", price:"₹51,406", tax:"(MRP inclusive of all taxes)", specs:{metal:"14KT",color:"Yellow Gold",diamond:"FG / VVSVS"} },
  { rating:"4.0 | 3 REVIEWS", title:"VIGHNAHARTA\nLAB-GROWN DIAMOND RELIGIOUS\nPENDANT", shortTitle:"VIGHNAHARTA", price:"₹45,549", tax:"(MRP inclusive of all taxes)", specs:{metal:"14KT",color:"Yellow Gold",diamond:"FG / VVSVS"} },
  { rating:"4.0 | 3 REVIEWS", title:"NIRVANA DEVINE OM\nLAB-GROWN DIAMOND RELIGIOUS\nPENDANT", shortTitle:"NIRVANA DEVINE OM", price:"₹55,693", tax:"(MRP inclusive of all taxes)", specs:{metal:"14KT",color:"Yellow Gold",diamond:"FG / VVSVS"} }
];

/* ================= SWIPE LOGIC ================= */
class Swipe{
  constructor(el,cb){
    this.cb=cb;
    el.addEventListener("pointerdown",e=>this.start(e));
    el.addEventListener("pointermove",e=>this.move(e));
    el.addEventListener("pointerup",e=>this.end(e));
  }
  start(e){ this.x0=e.clientX; this.y0=e.clientY; this.t0=Date.now(); this.active=true; }
  move(e){ if(!this.active) return; const dx=e.clientX-this.x0; if(Math.abs(dx)<3) return; this.cb.drag(dx); }
  end(e){
    if(!this.active) return;
    this.active=false;
    const dx=e.clientX-this.x0; const dy=e.clientY-this.y0; const dt=Date.now()-this.t0;
    if(Math.abs(dx)<10 && Math.abs(dy)<10 && dt<250){ this.cb.tap(); return; }
    if(Math.abs(dy)>Math.abs(dx) && Math.abs(dy)>80){ this.cb.vertical(); return; }
    if(Math.abs(dx)>80){ this.cb.swipe(dx>0?"RIGHT":"LEFT"); }else{ this.cb.release(); }
  }
}

/* ================= CARD COMPONENT ================= */
AFRAME.registerComponent("tinder-stack",{
init(){
  this.i=0; this.busy=false; this.flipped=false;
  this.luxGreen = "#013220"; 
  this.textWhite = "#ffffff";

  // Stack Peeks
  this.peek2=document.createElement("a-image");
  this.peek2.setAttribute("width","1"); this.peek2.setAttribute("height","1.4");
  this.peek2.setAttribute("position","0 -0.08 -0.06"); this.peek2.setAttribute("opacity","0.3");
  this.el.appendChild(this.peek2);

  this.peek1=document.createElement("a-image");
  this.peek1.setAttribute("width","1"); this.peek1.setAttribute("height","1.4");
  this.peek1.setAttribute("position","0 -0.04 -0.03"); this.peek1.setAttribute("opacity","0.5");
  this.el.appendChild(this.peek1);

  this.wrap=document.createElement("a-entity");
  this.wrap.setAttribute("position","0 0.2 0");
  this.el.appendChild(this.wrap);

  // FRONT SIDE
  this.front=document.createElement("a-entity");
  this.wrap.appendChild(this.front);

  this.frontImg=document.createElement("a-image");
  this.frontImg.setAttribute("width","1"); this.frontImg.setAttribute("height","1.4");
  this.frontImg.setAttribute("material","alphaTest:0.5; side:front;");
  this.front.appendChild(this.frontImg);

  this.frontInfo = document.createElement("a-plane");
  this.frontInfo.setAttribute("width", "1"); this.frontInfo.setAttribute("height", "0.25");
  this.frontInfo.setAttribute("position", "0 -0.575 0.01");
  this.frontInfo.setAttribute("material", `color: ${this.luxGreen}; opacity: 0.9; transparent: true;`);
  this.front.appendChild(this.frontInfo);

  this.fTitle = document.createElement("a-text");
  this.fTitle.setAttribute("width", "0.85"); this.fTitle.setAttribute("align", "left");
  this.fTitle.setAttribute("value", ""); this.fTitle.setAttribute("position", "-0.43 -0.52 0.02");
  this.fTitle.setAttribute("wrap-count", "35");
  this.front.appendChild(this.fTitle);

  this.fPrice = document.createElement("a-text");
  this.fPrice.setAttribute("width", "0.85"); this.fPrice.setAttribute("align", "left");
  this.fPrice.setAttribute("color", "#d4af37"); 
  this.fPrice.setAttribute("value", ""); this.fPrice.setAttribute("position", "-0.43 -0.62 0.02");
  this.front.appendChild(this.fPrice);

  // BACK SIDE
  this.back=document.createElement("a-plane");
  this.back.setAttribute("width","1"); this.back.setAttribute("height","1.4");
  this.back.setAttribute("color", this.luxGreen);
  this.back.setAttribute("position","0 0 -0.01");
  this.back.setAttribute("rotation","0 180 0");
  this.back.setAttribute("visible",false);
  this.wrap.appendChild(this.back);

  this.backContainer=document.createElement("a-entity");
  this.backContainer.setAttribute("position","0 0 0.005");
  this.backContainer.setAttribute("visible",false);
  this.back.appendChild(this.backContainer);

  const t=(y,w=0.9,c="#fff",a="center",v="")=>{
    const e=document.createElement("a-text");
    e.setAttribute("width",w); e.setAttribute("wrap-count","30");
    e.setAttribute("align",a); e.setAttribute("color",c); 
    e.setAttribute("value",v); e.setAttribute("position",`0 ${y} 0.01`);
    return e;
  };

  this.rating=t(0.62,0.8,"#d4af37"); 
  this.title=t(0.46,0.85,this.textWhite);
  this.price=t(0.30,0.9,this.textWhite); 
  this.tax=t(0.23,0.7,"#bbb");

  const createTile = (y, label) => {
    const border = document.createElement("a-plane");
    border.setAttribute("width", "0.85"); border.setAttribute("height", "0.1");
    border.setAttribute("material", "color: #ffffff; side: double; shader: flat;");
    border.setAttribute("position", `0 ${y} 0.005`);

    const fill = document.createElement("a-plane");
    fill.setAttribute("width", "0.84"); fill.setAttribute("height", "0.09");
    fill.setAttribute("color", this.luxGreen);
    fill.setAttribute("position", `0 ${y} 0.006`);

    this.backContainer.appendChild(border);
    this.backContainer.appendChild(fill);
    
    const labelT = t(y, 0.75, "#ccc", "left", label);
    labelT.setAttribute("position", `-0.38 ${y} 0.01`);
    this.backContainer.appendChild(labelT);
    
    const valueT = t(y, 0.75, this.textWhite, "right");
    valueT.setAttribute("position", `0.38 ${y} 0.01`);
    this.backContainer.appendChild(valueT);
    return valueT;
  };

  this.vMetal = createTile(0.04, "METAL");
  this.vColor = createTile(-0.07, "COLOR");
  this.vDiamond = createTile(-0.18, "DIAMOND");

  this.shopBtn=document.createElement("a-plane");
  this.shopBtn.setAttribute("width","0.85"); this.shopBtn.setAttribute("height","0.18");
  this.shopBtn.setAttribute("color", this.textWhite); 
  this.shopBtn.setAttribute("position","0 -0.5 0.01");
  
  this.shopTxt=t(-0.5,0.8, this.luxGreen, "center", "CONTINUE TO SHOP");
  this.backContainer.append(this.rating,this.title,this.price,this.tax,this.shopBtn,this.shopTxt);

  this.update();

  new Swipe(document.getElementById("touch"),{
    drag:dx=>this.drag(dx),
    release:()=>this.reset(),
    swipe:d=>this.swipe(d),
    tap:()=>window.open(LINKS[this.i%LINKS.length],"_blank"),
    vertical:()=>this.flip()
  });
  this.el.setAttribute("visible","false");
},

update(){
  const d = DETAILS[this.i % DETAILS.length];
  this.frontImg.setAttribute("src", IMAGES[this.i % IMAGES.length]);
  this.peek1.setAttribute("src", IMAGES[(this.i + 1) % IMAGES.length]);
  this.peek2.setAttribute("src", IMAGES[(this.i + 2) % IMAGES.length]);

  this.fTitle.setAttribute("value", d.shortTitle);
  this.fPrice.setAttribute("value", d.price);

  this.rating.setAttribute("value", d.rating);
  this.title.setAttribute("value", d.title);
  this.price.setAttribute("value", d.price);
  this.tax.setAttribute("value", d.tax);
  this.vMetal.setAttribute("value", d.specs.metal);
  this.vColor.setAttribute("value", d.specs.color);
  this.vDiamond.setAttribute("value", d.specs.diamond);
},

drag(dx){
  if(this.busy||this.flipped) return;
  const x=Math.max(-0.6,Math.min(0.6,dx/220));
  this.wrap.setAttribute("position",`${x} ${0.2+Math.abs(x)*0.05} 0`);
  this.wrap.setAttribute("rotation",`0 0 ${x*-14}`);
},

reset(){
  this.wrap.setAttribute("animation","property:position;to:0 0.2 0;dur:150;easing:easeOutCubic");
  this.wrap.setAttribute("animation__r","property:rotation;to:0 0 0;dur:150;easing:easeOutCubic");
},

swipe(dir){
  if(this.busy) return;
  this.busy=true;
  const s=dir==="LEFT"?-1:1;
  this.wrap.setAttribute("animation","property:position;to:"+1.8*s+" 0.3 -0.3;dur:250;easing:easeInCubic");
  
  setTimeout(()=>{
    this.i++;
    this.flipped=false;
    this.front.setAttribute("visible",true);
    this.back.setAttribute("visible",false);
    this.backContainer.setAttribute("visible",false);
    this.wrap.setAttribute("rotation","0 0 0");
    this.wrap.setAttribute("position","0 0.2 0");
    this.update();
    // Short lockout to prevent multi-swiping errors
    setTimeout(() => { this.busy=false; }, 100);
  },260);
},

flip(){
  if(this.busy) return;
  this.busy=true;
  const open=!this.flipped;
  this.back.setAttribute("visible",true);
  setTimeout(()=>{ this.front.setAttribute("visible",!open); this.backContainer.setAttribute("visible",open); },210);
  this.wrap.setAttribute("animation",`property:rotation;to:0 ${open?180:0} 0;dur:400;easing:easeInOutQuart`);
  setTimeout(()=>{
    this.flipped=open; this.busy=false;
    if(!this.flipped){ this.back.setAttribute("visible",false); this.backContainer.setAttribute("visible",false); }
  },400);
}
});
</script>

<a-scene mindar-image="imageTargetSrc: targets (1).mind; maxTrack:1; uiLoading:no; uiError:no; filterMinCF:0.001; filterBeta:0.01;" embedded renderer="alpha:true; antialias:true; colorManagement: true;" vr-mode-ui="enabled:false">
  <a-camera look-controls="enabled:false"></a-camera>
  <a-entity id="target" mindar-image-target="targetIndex:0">
    <a-entity tinder-stack position="0 0.05 0.12"></a-entity>
  </a-entity>
</a-scene>

<script>
const target=document.getElementById("target");
const card=document.querySelector("[tinder-stack]");
let hideTimeout;

target.addEventListener("targetFound",()=>{
  clearTimeout(hideTimeout);
  card.setAttribute("visible",true);
});

target.addEventListener("targetLost",()=>{
  // Keep card visible for 1 second after tracking lost to prevent flickering
  hideTimeout = setTimeout(() => {
    card.setAttribute("visible",false);
  }, 1000);
});
</script>

</body>
</html>
